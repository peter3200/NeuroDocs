<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Analysis Step 1: Timing Files &mdash; NeuroDocs 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reorient a Nifti Image" href="../misc/reorient.html" />
    <link rel="prev" title="Preproc Step 3: Brain Extraction" href="../preproc/prep3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NeuroDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Preprocessing (fMRIprep)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep_ov.html">Preprocessing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep1.html">Preproc Step 1: Data Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep2.html">Preproc Step 2: fMRIprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep3.html">Preproc Step 3: Brain Extraction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Analysis (FSL)</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Task Analysis Step 1: Timing Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-are-timing-files">What are timing files?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-timing-files">Creating timing files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#matlab-timing-files">MATLAB timing files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-timing-files">Python timing files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-examples-of-timing-files">Other examples of timing files</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Odds and Ends</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/reorient.html">Reorient a Nifti Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/openneuro.html">Download a Dataset from OpenNeuro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rtd.html">Read The Docs Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/addresources.html">Additional Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NeuroDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Task Analysis Step 1: Timing Files</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/task/task1.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="task-analysis-step-1-timing-files">
<h1>Task Analysis Step 1: Timing Files<a class="headerlink" href="#task-analysis-step-1-timing-files" title="Permalink to this heading"></a></h1>
<section id="what-are-timing-files">
<h2>What are timing files?<a class="headerlink" href="#what-are-timing-files" title="Permalink to this heading"></a></h2>
<p>Timing files are simple text files that contain the start time of a task trial, the duration of that trial, and the task contrast.</p>
<p>For example, let’s use a language localizer task. For this task, participants read sentences with words and strings of nonwords. So, our trial onset times will be whenever the sentences or nonwords are shown on the screen, the trial durations are the length of time the sentence or nonwords blocks are shown, and the task contrast label will indicate if it is a sentence or nonwords trial. This task can be downloaded from the EvLab <a class="reference external" href="https://evlab.mit.edu/funcloc/">website</a>.</p>
</section>
<section id="creating-timing-files">
<h2>Creating timing files<a class="headerlink" href="#creating-timing-files" title="Permalink to this heading"></a></h2>
<p>It is best to design your experiment with your first-level model in mind (and hence the timing files, which contribute to the formulation of that design). However, if you are using data that has been previously collected, it can be a little tricky to know where to start with these. However, this can be simplified into three basic steps:</p>
<ol class="arabic simple">
<li><p>Calculate trial onset times</p></li>
<li><p>Calculate trial durations</p></li>
<li><p>Label each trial with its particular task contrast label</p></li>
</ol>
<p>We will create these timing files for two different tasks using two different approaches: MATLAB and Python</p>
</section>
<section id="matlab-timing-files">
<h2>MATLAB timing files<a class="headerlink" href="#matlab-timing-files" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Load MATLAB, claim an <cite>salloc</cite> job, and launch MATLAB</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ml matlab/r2018b
<span class="gp">$ </span>salloc --mem-per-cpu 15G --time <span class="m">24</span>:00:00 --x11
<span class="gp">$ </span><span class="nv">LD_PRELOAD</span><span class="o">=</span> matlab
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>In MATLAB, view our example .mat task output file, which you can download on <a class="reference external" href="https://github.com/peter3200/NeuroDocs/blob/main/example_data/kan_langloc_ses-1_run-1_set1.mat">Github</a>.</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>load<span class="o">(</span><span class="s1">&#39;kan_langloc_ses-1_run-1_set1.mat&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>Within the <cite>subj_data</cite> structure, there are a few variables:</p>
<img alt="../_images/t1.png" src="../_images/t1.png" />
<dl class="simple">
<dt>Here is what each variable means in the context of the language localizer task</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id,</span> <span class="pre">set,</span> <span class="pre">run</span></code>: these are defined when the task is run in the scanner</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_onset</span></code>: the beginning of the timer for this run</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fix_onsets</span></code>: the value of the timer at the beginnig of each fixation block</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">i_trial_onsets</span></code>: used to store the expected length of trials</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trial_onsets</span></code>: the actual individual trial onset times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">did_respond</span></code>: if thte subject actually pressed a key during the attention probe</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">probe_onset</span></code>: when the participant responds to the attention probe</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime</span></code>: end time minus start time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rt</span></code>: probe_response minus probe_onset</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When time is recorded for this task, it is absolute relative to the internal computer clock, so to get the relative time of trial_onset with respect to run_onset we’ll need to calculate trial_onset - run_onset to get a more interpretable value.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Create two timing files (EV1 and Ev2). The script is available to lab members on <a class="reference external" href="https://github.com/Nielsen-Brain-and-Behavior-Lab/AutismHemisphericSpecialization/blob/main/activation_maps/timing_files/make_langloc_timing_220407.m">Github</a>.</p></li>
</ol>
<p>The first step is to set up paths and basic variables:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Step 0: Set paths and variables</span><span class="w"></span>
<span class="n">timing_project_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/code/timing_files/raw_data&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">timing_prefix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;kan_langloc_ses-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">SUB</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Pilot002&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">SES</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">RUN</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;2&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">SET</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Next, we will load the .mat file and create more variables:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Step 1: Load files, calculate vars</span><span class="w"></span>
<span class="n">ses</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">SES</span><span class="p">);</span><span class="w"></span>
<span class="nb">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">RUN</span><span class="p">);</span><span class="w"></span>
<span class="nb">set</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">SET</span><span class="p">);</span><span class="w"></span>
<span class="n">timing_run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_run-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">timing_set</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_set&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">timing_suffix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;.mat&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">tf_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">timing_prefix</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">timing_run</span><span class="p">,</span><span class="nb">run</span><span class="p">,</span><span class="n">timing_set</span><span class="p">,</span><span class="nb">set</span><span class="p">,</span><span class="n">timing_suffix</span><span class="p">);</span><span class="w"></span>
<span class="n">tf_str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">timing_project_dir</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">tf_name</span><span class="p">);</span><span class="w"></span>
<span class="n">new_tf</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">load</span><span class="p">(</span><span class="n">tf_str</span><span class="p">);</span><span class="w"> </span><span class="c">%load the file</span><span class="w"></span>

<span class="n">out_sub</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/sub-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">out_ses</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/ses-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">out_ses2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_ses-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">out_func</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/func&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">out_suffix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_langloc_timing.txt&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">out_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/fmriprep_results/fmriprep/sub-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">output_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">out_func</span><span class="p">);</span><span class="w"> </span><span class="c">%output directory location</span><span class="w"></span>
<span class="n">output_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_sub</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses2</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">timing_run</span><span class="p">,</span><span class="nb">run</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">);</span><span class="w"> </span><span class="c">%output filename</span><span class="w"></span>
<span class="n">output_total</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">output_name</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Now we are ready to create different timing files depending on the set. For this task, the trials are presented in a different order depending on if the set is 1 or 2.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%Step 2: Create different timing files depending on if the set is 1 or 2  (the sets are counterbalanced in presentation of S vs N)</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="n">RUN</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="w"> </span><span class="c">%RUN 1 = SNNS - NSNS - SNSN - NSSN (words for 5400 ms)</span><span class="w"></span>
<span class="w"> </span><span class="c">%Create EV 1: Sentence</span><span class="w"></span>
<span class="w"> </span><span class="n">all_onset</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">trial_onsets</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">run_onset</span><span class="p">];</span><span class="w"></span>
<span class="w"> </span><span class="n">fix_onset</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">fix_onsets</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">run_onset</span><span class="p">];</span><span class="w"></span>
<span class="w"> </span><span class="n">NONWORD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">48</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain NONWORD onset time</span><span class="w"></span>
<span class="w"> </span><span class="n">SENTENCE</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">45</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain SENTENCE onset time</span><span class="w"></span>
<span class="w"> </span><span class="n">onset1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="n">SENTENCE</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%list of onset times for SENTENCES</span><span class="w"></span>
<span class="w"> </span><span class="n">fix1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%onset time for first fixation</span><span class="w"></span>
<span class="w"> </span><span class="n">fix2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix5</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix2</span><span class="p">;</span><span class="w"> </span><span class="c">%add in fixation onset times</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">39</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">52</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix5</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">12</span><span class="p">);</span><span class="w"> </span><span class="c">%add in task onset times</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">14</span><span class="p">:</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">13</span><span class="p">:</span><span class="mi">24</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">27</span><span class="p">:</span><span class="mi">38</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">25</span><span class="p">:</span><span class="mi">36</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">40</span><span class="p">:</span><span class="mi">51</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">all_dur</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">diff</span><span class="p">(</span><span class="n">con_fix</span><span class="p">);</span><span class="w"> </span><span class="c">%find duration for fixation and task</span><span class="w"></span>
<span class="w"> </span><span class="n">NW_dur</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="mi">51</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain duration for NONWORDS</span><span class="w"></span>
<span class="w"> </span><span class="n">ST_dur</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">48</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain duation for SENTENCE</span><span class="w"></span>
<span class="w"> </span><span class="n">duration1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_dur</span><span class="p">(</span><span class="n">ST_dur</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%grab duration for sentence values</span><span class="w"></span>
<span class="w"> </span><span class="n">value1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repelem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">EV1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="n">onset1</span><span class="p">,</span><span class="w"> </span><span class="n">duration1</span><span class="p">,</span><span class="w"> </span><span class="n">value1</span><span class="p">);</span><span class="w"> </span><span class="c">%create table</span><span class="w"></span>
<span class="w"> </span><span class="n">out_suffix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_langloc_timing_EV1.txt&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">out_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/fmriprep_results/fmriprep/sub-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">output_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">out_func</span><span class="p">);</span><span class="w"> </span><span class="c">%output directory location</span><span class="w"></span>
<span class="w"> </span><span class="n">output_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_sub</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses2</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">timing_run</span><span class="p">,</span><span class="nb">run</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">);</span><span class="w"> </span><span class="c">%output filename</span><span class="w"></span>
<span class="w"> </span><span class="n">output_total</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">output_name</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="nb">writetable</span><span class="p">(</span><span class="n">EV1</span><span class="p">,</span><span class="w"> </span><span class="n">output_total</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Delimiter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;\t&#39;</span><span class="p">,</span><span class="s">&#39;WriteVariableNames&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="c">%Create EV 2: Nonwords</span><span class="w"></span>
<span class="w"> </span><span class="n">onset2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="n">NONWORD</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%nonword onset tme</span><span class="w"></span>
<span class="w"> </span><span class="n">duration2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_dur</span><span class="p">(</span><span class="n">NW_dur</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">value2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repelem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">EV2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="n">onset2</span><span class="p">,</span><span class="w"> </span><span class="n">duration2</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">);</span><span class="w"> </span><span class="c">%create table</span><span class="w"></span>
<span class="w"> </span><span class="n">out_suffix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_langloc_timing_EV2.txt&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">out_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/fmriprep_results/fmriprep/sub-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">output_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">out_func</span><span class="p">);</span><span class="w"> </span><span class="c">%output directory location</span><span class="w"></span>
<span class="w"> </span><span class="n">output_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_sub</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses2</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">timing_run</span><span class="p">,</span><span class="nb">run</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">);</span><span class="w"> </span><span class="c">%output filename</span><span class="w"></span>
<span class="w"> </span><span class="n">output_total</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">output_name</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="nb">writetable</span><span class="p">(</span><span class="n">EV2</span><span class="p">,</span><span class="w"> </span><span class="n">output_total</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Delimiter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;\t&#39;</span><span class="p">,</span><span class="s">&#39;WriteVariableNames&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>If it is the second set (run), then we will create the timing files using this code:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">else</span><span class="w">   </span><span class="c">%RUN 2 = NSSN - SNSN - NSNS - SNNS (words for 5400 ms)</span><span class="w"></span>
<span class="w"> </span><span class="c">%EV2: Nonwords</span><span class="w"></span>
<span class="w"> </span><span class="n">all_onset</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">trial_onsets</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">run_onset</span><span class="p">];</span><span class="w"></span>
<span class="w"> </span><span class="n">fix_onset</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">fix_onsets</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">new_tf</span><span class="p">.</span><span class="n">subj_data</span><span class="p">.</span><span class="n">run_onset</span><span class="p">];</span><span class="w"></span>
<span class="w"> </span><span class="n">SENTENCE</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">39</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">48</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain SENTENCE onset time</span><span class="w"></span>
<span class="w"> </span><span class="n">NONWORD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">45</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain NONWORD onset time</span><span class="w"></span>
<span class="w"> </span><span class="n">onset2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="n">NONWORD</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%onset time for first fixation</span><span class="w"></span>
<span class="w"> </span><span class="n">fix2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">fix5</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix_onset</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix2</span><span class="p">;</span><span class="w"> </span><span class="c">%add in fixation onset times</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">39</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">52</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fix5</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">12</span><span class="p">);</span><span class="w"> </span><span class="c">%add in task onset times</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">14</span><span class="p">:</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">13</span><span class="p">:</span><span class="mi">24</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">27</span><span class="p">:</span><span class="mi">38</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">25</span><span class="p">:</span><span class="mi">36</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">con_fix</span><span class="p">(</span><span class="mi">40</span><span class="p">:</span><span class="mi">51</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="mi">37</span><span class="p">:</span><span class="mi">48</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">all_dur</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">diff</span><span class="p">(</span><span class="n">con_fix</span><span class="p">);</span><span class="w"> </span><span class="c">%find duration for fixation and task</span><span class="w"></span>
<span class="w"> </span><span class="n">ST_dur</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="mi">51</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain duration for SENTENCES</span><span class="w"></span>
<span class="w"> </span><span class="n">NW_dur</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">48</span><span class="p">];</span><span class="w"> </span><span class="c">%cells that contain duation for NONWORDS</span><span class="w"></span>
<span class="w"> </span><span class="n">duration2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_dur</span><span class="p">(</span><span class="n">NW_dur</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c">%duration</span><span class="w"></span>
<span class="w"> </span><span class="n">value2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repelem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">EV2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="n">onset2</span><span class="p">,</span><span class="w"> </span><span class="n">duration2</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">);</span><span class="w"> </span><span class="c">%create table</span><span class="w"></span>
<span class="w"> </span><span class="n">out_suffix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_langloc_timing_EV2.txt&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">out_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/fmriprep_results/fmriprep/sub-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">output_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">out_func</span><span class="p">);</span><span class="w"> </span><span class="c">%output directory location</span><span class="w"></span>
<span class="w"> </span><span class="n">output_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_sub</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses2</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">timing_run</span><span class="p">,</span><span class="nb">run</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">);</span><span class="w"> </span><span class="c">%output filename</span><span class="w"></span>
<span class="w"> </span><span class="n">output_total</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">output_name</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="nb">writetable</span><span class="p">(</span><span class="n">EV2</span><span class="p">,</span><span class="w"> </span><span class="n">output_total</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Delimiter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;\t&#39;</span><span class="p">,</span><span class="s">&#39;WriteVariableNames&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="c">%EV1: Sentences</span><span class="w"></span>
<span class="w"> </span><span class="n">onset1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_onset</span><span class="p">(</span><span class="n">SENTENCE</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">duration1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">all_dur</span><span class="p">(</span><span class="n">ST_dur</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="n">value1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repelem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">EV1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="n">onset1</span><span class="p">,</span><span class="w"> </span><span class="n">duration1</span><span class="p">,</span><span class="w"> </span><span class="n">value1</span><span class="p">);</span><span class="w"> </span><span class="c">%create table</span><span class="w"></span>
<span class="w"> </span><span class="n">out_suffix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;_langloc_timing_EV1.txt&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">out_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/fmriprep_results/fmriprep/sub-&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="n">output_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">out_func</span><span class="p">);</span><span class="w"> </span><span class="c">%output directory location</span><span class="w"></span>
<span class="w"> </span><span class="n">output_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="n">out_sub</span><span class="p">,</span><span class="n">SUB</span><span class="p">,</span><span class="n">out_ses2</span><span class="p">,</span><span class="n">ses</span><span class="p">,</span><span class="n">timing_run</span><span class="p">,</span><span class="nb">run</span><span class="p">,</span><span class="n">out_suffix</span><span class="p">);</span><span class="w"> </span><span class="c">%output filename</span><span class="w"></span>
<span class="w"> </span><span class="n">output_total</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="n">output_name</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="nb">writetable</span><span class="p">(</span><span class="n">EV1</span><span class="p">,</span><span class="w"> </span><span class="n">output_total</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Delimiter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;\t&#39;</span><span class="p">,</span><span class="s">&#39;WriteVariableNames&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Look for and view the output EV files (found in your out_dir, which in this case is the fmriprep results folder)</p></li>
</ol>
<img alt="../_images/t6.png" src="../_images/t6.png" />
</section>
<section id="python-timing-files">
<h2>Python timing files<a class="headerlink" href="#python-timing-files" title="Permalink to this heading"></a></h2>
<p>We are going to use a different task and a different language to approach timing files! Some background: this “linetask” is a line bisection task, for which participants view a vertical line bisected by a horizontal line. For LENGTH trials, they are asked to select if the top or bottom section of the vertical line is longer. For COLOR trials, they determine if the top or bottom of the vertical line is brighter. Unlike the language task, trial durations are determined by the participant’s response speed.</p>
<ol class="arabic simple" start="0">
<li><p>The raw output for this task is in EPrime format. These EPrime files were first converted to .excel files using EPrime and then to .csv files using Excel. You can download an example .csv output file to use with this script from <a class="reference external" href="https://github.com/peter3200/NeuroDocs/blob/main/example_data/LineTask_ses-1_run-2.csv">Github</a>.</p></li>
<li><p>Load python.</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ml python/3.6
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run our script! Lab members can access this script on <a class="reference external" href="https://github.com/Nielsen-Brain-and-Behavior-Lab/AutismHemisphericSpecialization/blob/main/activation_maps/timing_files/make_landmark_timing_x2_220408.py">Github</a>.</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python make_landmark_timing_x2_220408.py
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Check for output in your output directory (here specified as input folder). There should be two EV files for each run.</p></li>
</ol>
<img alt="../_images/t7.png" src="../_images/t7.png" />
<p><strong>What did the python script do?</strong></p>
<ul class="simple">
<li><p>First, we set up our environment, loading the needed modules and setting our input directory.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#Load packages</span>
 <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
 <span class="kn">import</span> <span class="nn">time</span>
 <span class="kn">import</span> <span class="nn">os</span>
 <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span> <span class="k">as</span> <span class="n">pjoin</span>
 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">scipy.io</span> <span class="c1">#loads .mat files</span>
 <span class="kn">import</span> <span class="nn">csv</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">glob</span>
<span class="c1">#Loop through each subject/sess/run</span>
 <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;/fslgroup/fslg_spec_networks/compute/code/timing_files/raw_data&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Next, we set up our <cite>for loops</cite> to loop through each subject and then each landmark task output file within that subject directory. Then we went to work grabbing our timing file components.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span> <span class="c1">#loop through each subject within the &quot;directory&quot;</span>
     <span class="n">sub_count</span> <span class="o">=</span> <span class="n">sub_count</span> <span class="o">+</span> <span class="mi">1</span>
     <span class="n">sub_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
     <span class="n">subdir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">sub_name</span><span class="p">)</span>
     <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subdir</span><span class="si">}</span><span class="s1">/LineTask_ses-*.csv&#39;</span><span class="p">):</span> <span class="c1">#loop through each landmark task output file</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
             <span class="c1">#Create full dataset</span>
                <span class="n">orig_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">83</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">119</span><span class="p">])</span> <span class="c1">#grab all of the data</span>
                <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NaN&#39;</span> <span class="c1">#create empty column called &#39;value&#39;</span>
                <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;Procedure[Trial]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;ColTrial&quot;</span> <span class="k">else</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="c1">#if the type of trial is ColTrial, give it a value os 1, otherwise 2</span>
                <span class="n">orig_df</span> <span class="o">=</span> <span class="n">orig_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#replace NAs with 0 so you can combine columns to make single RT and OT variables</span>
                <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;RT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;ColSlide.RT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;LenSlide.RT&#39;</span><span class="p">]</span> <span class="c1">#create a single RT variable</span>
                <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;OT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;ColSlide.OnsetTime&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;LenSlide.OnsetTime&#39;</span><span class="p">]</span> <span class="c1">#create a single OT variable</span>
                <span class="n">new_RT_df</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[[</span><span class="s1">&#39;RT&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]]</span>
                <span class="n">new_OT_df</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[[</span><span class="s1">&#39;OT&#39;</span><span class="p">]]</span>
                <span class="n">gold_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">new_OT_df</span><span class="p">,</span> <span class="n">new_RT_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#create dataframe with onset, response time, and value</span>
                <span class="n">gold_df</span> <span class="o">=</span> <span class="n">gold_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span> <span class="p">,</span> <span class="p">:]</span> <span class="c1">#reemove the first row</span>
                <span class="n">gold_df</span><span class="p">[</span><span class="s1">&#39;OT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gold_df</span><span class="p">[</span><span class="s1">&#39;OT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">#convert miliseconds to seconds for OT</span>
                <span class="n">gold_df</span><span class="p">[</span><span class="s1">&#39;RT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gold_df</span><span class="p">[</span><span class="s1">&#39;RT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">#convert miliseconds to seconds for RT</span>
</pre></div>
</div>
<ul class="simple">
<li><p>After that, we created two EV files – one for the LEN trials and one for the COL trials and then saved them in the input directory.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Create EV1 dataset and timing file (LEN trials)</span>
        <span class="n">EV1_df</span> <span class="o">=</span> <span class="n">gold_df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">EV1_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">EV1_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">EV1_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#drop all ColTrials==1</span>
        <span class="n">EV1_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EV1_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span> <span class="k">else</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>  <span class="c1">#replace 2 with 1</span>
        <span class="n">EV1_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">EV1_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">EV1_df</span><span class="p">[</span><span class="s1">&#39;RT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#remove RT of 0.0</span>

<span class="c1">#Create EV2 dataset and timing file (COL trials)</span>
        <span class="n">EV2_df</span> <span class="o">=</span> <span class="n">gold_df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">EV2_df</span> <span class="o">=</span> <span class="n">EV2_df</span><span class="p">[</span><span class="n">EV2_df</span><span class="o">.</span><span class="n">value</span><span class="o">!=</span> <span class="s2">&quot;2&quot;</span><span class="p">]</span> <span class="c1">#Drop LEN trials (==2)</span>
        <span class="n">EV2_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">EV2_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">EV2_df</span><span class="p">[</span><span class="s1">&#39;RT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#remove RT of 0.0</span>

<span class="c1">#Save the EV1 (LEN) dataframe as .txt file</span>
        <span class="n">new_file</span> <span class="o">=</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">EV1_out_name</span> <span class="o">=</span> <span class="n">new_file</span> <span class="o">+</span> <span class="s1">&#39;_EV1&#39;</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
        <span class="n">EV1_out_file</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">EV1_out_name</span><span class="p">)</span>
        <span class="n">EV1_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">EV1_out_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#Save the EV2 (COL) dataframe as .txt file</span>
        <span class="n">EV2_out_name</span> <span class="o">=</span> <span class="n">new_file</span> <span class="o">+</span> <span class="s1">&#39;_EV2&#39;</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
        <span class="n">EV2_out_file</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">EV2_out_name</span><span class="p">)</span>
        <span class="n">EV2_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">EV2_out_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="other-examples-of-timing-files">
<h2>Other examples of timing files<a class="headerlink" href="#other-examples-of-timing-files" title="Permalink to this heading"></a></h2>
<p>As a primer with a simplified example, we highly recommend Andy’s Brain Book! Check out <a class="reference external" href="https://andysbrainbook.readthedocs.io/en/latest/fMRI_Short_Course/Statistics/05_Creating_Timing_Files.html">Chapter 5</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../preproc/prep3.html" class="btn btn-neutral float-left" title="Preproc Step 3: Brain Extraction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../misc/reorient.html" class="btn btn-neutral float-right" title="Reorient a Nifti Image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, M. Peterson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>