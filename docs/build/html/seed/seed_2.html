<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seed-based Analysis Step 2 &mdash; NeuroDocs 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Seed-based Analysis Step 3" href="seed_3.html" />
    <link rel="prev" title="Seed-based Analysis Step 1" href="seed_1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NeuroDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Preprocessing (fMRIprep)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep_ov.html">Preprocessing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep1.html">Preproc Step 1: Data Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep2.html">Preproc Step 2: fMRIprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep3.html">Preproc Step 3: Brain Extraction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Analysis (FSL)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../task/task1.html">Task Analysis Step 1: Timing Files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Preprocessing (CBIG2016)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_ov.html">CBIG2016 Preprocessing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_0.html">CBIG2016 Preproc  Step 0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_1.html">CBIG2016 Preproc Step 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_2.html">CBIG2016 Preproc Step 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_3.html">CBIG2016 Preproc Step 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_4.html">CBIG2016 Preproc: Tedana Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seed-based rsfMRI Analysis</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="seed_ov.html">Seed-based rs-fMRI Analysis Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="seed_1.html">Seed-based Analysis Step 1</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Seed-based Analysis Step 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-cifti-format">What is Cifti Format?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correlation-to-cifti">Correlation To Cifti</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="seed_3.html">Seed-based Analysis Step 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="seed_4.html">Seed-based Analysis Step 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="seed_5.html">Seed-based Analysis Step 5</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Odds and Ends</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/freesurfer.html">Installing Freesurfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/openneuro.html">Download a Dataset from OpenNeuro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rclone.html">Rclone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/reorient.html">Reorient a Nifti Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rtd.html">Read The Docs Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/addresources.html">Additional Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NeuroDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Seed-based Analysis Step 2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/seed/seed_2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="seed-based-analysis-step-2">
<h1>Seed-based Analysis Step 2<a class="headerlink" href="#seed-based-analysis-step-2" title="Permalink to this heading"></a></h1>
<p>Now that we’ve obtained a full-surface correlation matrix (potentially z-transformed), the next step is to convert this massive matrix into a surface file (cifti format).</p>
<section id="what-is-cifti-format">
<h2>What is Cifti Format?<a class="headerlink" href="#what-is-cifti-format" title="Permalink to this heading"></a></h2>
<p>There are several subtypes of cifti files, but they all have one thing in common–they represent data on the surface without being constrained to surface location. This means that any cifti file with X number of vertices can be displayed or overlaid on a surface structure file with that same number of vertices even if that surface file is the pial surface, inflated, or very inflated!</p>
<p>For this tutorial, we will be working with .dconn.nii files, which stores connectivity values. For more information on other types of cifti files and their uses, we highly recommend the layman’s guide to working with cifti files (<a class="reference external" href="https://mandymejia.com/2015/08/10/a-laymans-guide-to-working-with-cifti-files/">https://mandymejia.com/2015/08/10/a-laymans-guide-to-working-with-cifti-files/</a>).</p>
</section>
<section id="correlation-to-cifti">
<h2>Correlation To Cifti<a class="headerlink" href="#correlation-to-cifti" title="Permalink to this heading"></a></h2>
<p>To make this happen, we are going to load the following script in Matlab! This script takes advantage of the CBIG function to write a correlation matrix into .dconn.nii cifti format.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Purpose: Convert full surface correlation matrices into CIFTI surface</span><span class="w"></span>
<span class="c">% files for HCP Workbench viewing</span><span class="w"></span>
<span class="c">% Input: Full-surface correlation matrix averaged across runs</span><span class="w"></span>
<span class="c">% (consider using CBIG full surface correlation script)</span><span class="w"></span>
<span class="c">% Output: 1 CIFTI file per individual.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% Written by M. Peterson, Nielsen Brain and Behavior Lab</span><span class="w"></span>

<span class="c">%To run:</span><span class="w"></span>
<span class="c">%    1. Claim computing resources using salloc (ex: `salloc --mem-per-cpu 300G --time 2:00:00 --x11`)</span><span class="w"></span>
<span class="c">%    2. Source your CBIG config file to set up CBIG environment.</span><span class="w"></span>
<span class="c">%    3. Load matlab module: `ml matlab/r2018b`</span><span class="w"></span>
<span class="c">%    4. Enter the command `LD_PRELOAD= matlab`</span><span class="w"></span>


<span class="c">% prep for usage</span><span class="w"></span>
<span class="nb">clear</span><span class="w"> </span><span class="nb">all</span><span class="w"></span>
<span class="nb">setenv</span><span class="p">(</span><span class="s">&#39;TMPDIR&#39;</span><span class="p">,</span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/tmp&#39;</span><span class="p">)</span><span class="w"></span>

<span class="c">% Set project and subject variables</span><span class="w"></span>
<span class="n">project_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/fslgroup/fslg_spec_networks/compute/results/MSC_analysis/parc_output_fs6_MSC_ALL/quant_metrics/FC_matrices&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">sublist1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;MSC01&quot;</span><span class="w"> </span><span class="s">&quot;MSC02&quot;</span><span class="w"> </span><span class="s">&quot;MSC03&quot;</span><span class="w"> </span><span class="s">&quot;MSC04&quot;</span><span class="w"> </span><span class="s">&quot;MSC05&quot;</span><span class="w"> </span><span class="s">&quot;MSC06&quot;</span><span class="w"> </span><span class="s">&quot;MSC07&quot;</span><span class="w"> </span><span class="s">&quot;MSC08&quot;</span><span class="w"> </span><span class="s">&quot;MSC09&quot;</span><span class="w"> </span><span class="s">&quot;MSC10&quot;</span><span class="p">];</span><span class="w"></span>

<span class="c">% Loop through each subject and call CBIG_write_correlation_matrix script</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sublist1</span><span class="w"></span>
<span class="w">    </span><span class="c">%input file</span><span class="w"></span>
<span class="w">    </span><span class="n">filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="s">&#39;sub-&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sub</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_avg_FC.mat&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">fullname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb">load</span><span class="p">(</span><span class="n">fullname</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">%output file</span><span class="w"></span>
<span class="w">    </span><span class="n">output_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcat</span><span class="p">(</span><span class="s">&#39;sub-&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sub</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_avg_FC&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">%call CBIG script</span><span class="w"></span>
<span class="w">    </span><span class="n">CBIG_write_correlation_matrix_into_ciftiformat</span><span class="p">(</span><span class="n">ind_avg</span><span class="p">,</span><span class="w"> </span><span class="n">output_name</span><span class="p">,</span><span class="w"> </span><span class="n">project_dir</span><span class="p">);</span><span class="w"> </span><span class="c">%automatically saved as a .dconn.nii file</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Matlab will require a lot of RAM to load in the large correlation matrix and write out an equally large cifti file. Be sure to request ~300G of memory in your <cite>salloc</cite> job.</p>
</div>
<p>The next step is to work with the file in workbench!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="seed_1.html" class="btn btn-neutral float-left" title="Seed-based Analysis Step 1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="seed_3.html" class="btn btn-neutral float-right" title="Seed-based Analysis Step 3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, M. Peterson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>