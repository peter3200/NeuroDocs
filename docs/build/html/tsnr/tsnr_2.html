<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tSNR Step 2: Surface Projection &mdash; NeuroDocs 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tSNR Step 3: Wtihin-Network Averaging" href="tsnr_3.html" />
    <link rel="prev" title="tSNR Step 1: tSNR Calculation" href="tsnr_1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NeuroDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Preprocessing (fMRIprep)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep_ov.html">Preprocessing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep1.html">Preproc Step 1: Data Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep2.html">Preproc Step 2: fMRIprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preproc/prep3.html">Preproc Step 3: Brain Extraction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Analysis (FSL)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../task/task1.html">Task Analysis Step 1: Timing Files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Preprocessing (CBIG2016)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_ov.html">CBIG2016 Preprocessing Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_0.html">CBIG2016 Preproc  Step 0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_1.html">CBIG2016 Preproc Step 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_2.html">CBIG2016 Preproc Step 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_3.html">CBIG2016 Preproc Step 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cprep/cprep_4.html">CBIG2016 Preproc: Tedana Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parcellation (Kong2019)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_ov.html">Kong2019 Parcellation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_0.html">Kong2019 Parc Step 0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_1.html">Kong2019 Parc Step 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_2.html">Kong2019 Parc Step 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_3.html">Kong2019 Parc Step 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_4.html">Kong2019 Parc Step 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_5.html">Kong2019 Parc Step 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2019/parc_6.html">Kong2019 Parc: Training Your Own Priors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parcellation (Kong2022)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kong2022/parc_ov.html">Kong2022 Parcellation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2022/parc_0.html">Kong2022 Step 0: Generate Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2022/parc_1.html">Kong2022 Step 1: Generate Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2022/parc_2.html">Kong2022 Step 2: Group Priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2022/parc_3.html">Kong2022 Step 3: Generate Individual Parcellations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kong2022/parc_4.html">Kong2022 Step 4: Hungarian Matching and Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parcellation (K-means)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kmeans/kmeans_ov.html">K-means Parcellation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kmeans/kmeans_1.html">K-means Parc Step 1: Concatenate Timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kmeans/kmeans_2.html">K-means Parc Step 2: K-means Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kmeans/kmeans_3.html">K-means Parc Step 3: Hungarian Matching and Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seed-based rsfMRI Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../seed/seed_ov.html">Seed-based rs-fMRI Analysis Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seed/seed_1.html">Seed-based Analysis Step 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seed/seed_2.html">Seed-based Analysis Step 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seed/seed_3.html">Seed-based Analysis Step 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seed/seed_4.html">Seed-based Analysis Step 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seed/seed_5.html">Seed-based Analysis Step 5</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">tSNR Maps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tsnr_ov.html">tSNR Maps Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="tsnr_1.html">tSNR Step 1: tSNR Calculation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">tSNR Step 2: Surface Projection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-script">Step 2 Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#expected-output">Expected Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tsnr_3.html">tSNR Step 3: Wtihin-Network Averaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="tsnr_4.html">tSNR Step 4: Group-Averaged tSNR Map</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Odds and Ends</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/aws.html">Implementing AWS CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/freesurfer.html">Installing Freesurfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/conda.html">Installing Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/matlab.html">Using MATLAB in a Supercomputing Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/openneuro.html">Download a Dataset from OpenNeuro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rclone.html">Rclone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/reorient.html">Reorient a Nifti Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rtd.html">Read The Docs Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/split.html">Split A BOLD Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/addresources.html">Additional Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NeuroDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>tSNR Step 2: Surface Projection</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tsnr/tsnr_2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tsnr-step-2-surface-projection">
<h1>tSNR Step 2: Surface Projection<a class="headerlink" href="#tsnr-step-2-surface-projection" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>For this step, we will use FreeSurfer functions to project the run tSNR maps to the fsaverage6 surface. This could easily be adapted to the fsaverage or fsaverage5 resolutions, but the resolution does need to be compatible with your parcellation resolution if you wish to average within network boundaries (step 3).</p>
</section>
<section id="step-2-script">
<h2>Step 2 Script<a class="headerlink" href="#step-2-script" title="Permalink to this heading"></a></h2>
<p>To accomplish this, we will use a bash shell script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#Purpose: Project tSNR maps to fsaverage6 surface.</span>
<span class="c1">#Inputs: tSNR maps from Step1, freesurfer native output</span>
<span class="c1">#Outputs: .shape.gii (HCP WB compatible) surface SNR maps</span>
<span class="c1">#Written by M. Peterson, Nielsen Brain and Behavior Lab under MIT License 2022</span>

<span class="c1">#SET PATHS</span>
<span class="nv">CODE_DIR</span><span class="o">=</span>/fslgroup/fslg_spec_networks/compute/code/HCP_analysis/tSNR/ALL <span class="c1">#code directory where this script is housed</span>
<span class="nv">PREP_DIR</span><span class="o">=</span>/fslgroup/fslg_autism_networks/compute/HCP_analysis/CBIG2016_preproc_FS6_ALL <span class="c1">#preproc output directory</span>
<span class="nv">T_DIR</span><span class="o">=</span>/fslgroup/grp_hcp/compute/HCP_analysis/parc_output_fs6_HCP_ALL/quant_metrics/tSNR <span class="c1">#tSNR output directory</span>
<span class="nv">FS_DIR</span><span class="o">=</span>/fslgroup/grp_proc/compute/HCP_analysis/HCP_download <span class="c1">#FreeSurfer recon-all output directory</span>
<span class="nv">SUBJECTS_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">FREESURFER_HOME</span><span class="si">}</span>/subjects <span class="c1">#Set to $FREESURFER_HOME in order to use template fsaverage6 surface</span>

<span class="c1">#LOOP THROUGH EACH SUBJECT AND TASK</span>
<span class="k">for</span> SUBJ <span class="k">in</span> <span class="sb">`</span>cat <span class="nv">$CODE_DIR</span>/ids.txt<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> <span class="c1">#IDs text file</span>
    <span class="k">for</span> SESS <span class="k">in</span> <span class="o">{</span><span class="m">1</span>..4<span class="o">}</span><span class="p">;</span> <span class="k">do</span> <span class="c1">#maximum of four sessions per subject</span>
        <span class="c1">#BBREGISTER (OBTAIN AFFINE.REG)</span>
        bbregister <span class="se">\</span>
        --bold <span class="se">\</span>
        --s fsaverage6 <span class="se">\</span>
        --init-fsl <span class="se">\</span>
        --mov <span class="si">${</span><span class="nv">PREP_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>/bold/00<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_bld00<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_rest_skip4_mc.nii.gz <span class="se">\</span>
        --reg <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_register.dat

        <span class="c1">#MRI_VOL2SURF LH</span>
        mri_vol2surf --mov <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_PREPROC_TSNR.nii.gz <span class="se">\</span>
        --reg <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_register.dat <span class="se">\</span>
        --hemi lh <span class="se">\</span>
        --projfrac <span class="m">0</span>.5 <span class="se">\</span>
        --o <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_lh.shape.gii <span class="se">\</span>
        --noreshape <span class="se">\</span>
        --interp trilinear

        <span class="c1">#MRI_VOL2SURF RH</span>
        mri_vol2surf --mov <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_PREPROC_TSNR.nii.gz <span class="se">\</span>
        --reg <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_register.dat <span class="se">\</span>
        --hemi rh <span class="se">\</span>
        --projfrac <span class="m">0</span>.5 <span class="se">\</span>
        --o <span class="si">${</span><span class="nv">T_DIR</span><span class="si">}</span>/sub-<span class="si">${</span><span class="nv">SUBJ</span><span class="si">}</span>_sess-<span class="si">${</span><span class="nv">SESS</span><span class="si">}</span>_rh.shape.gii <span class="se">\</span>
        --noreshape <span class="se">\</span>
        --interp trilinear

    <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="expected-output">
<h2>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h2>
<p>Following the implementation of this script, there should be a LH and RH GIFTI file for each run per participant.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tsnr_1.html" class="btn btn-neutral float-left" title="tSNR Step 1: tSNR Calculation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tsnr_3.html" class="btn btn-neutral float-right" title="tSNR Step 3: Wtihin-Network Averaging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, M. Peterson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>